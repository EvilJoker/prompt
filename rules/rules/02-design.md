# 📐 功能设计流程规则

## 🏷️ 规则元数据
- **类型**: 研发流程规范
- **编号**: 02
- **版本**: v2.4
- **描述**: 通用功能设计流程规范，简化高效的设计方案输出
- **触发条件**: 前缀 `design` 或包含关键词 ["设计", "功能", "architecture", "方案"]
- **执行模式**: 6步交互式设计 → 逐步确认 → 一致性维护 → 移交开发
- **依赖规则**: `02-common-standards.md`, `01-requirements.md`

---

## 🎯 设计目标

**核心理念**: 将业务需求转化为完整的技术设计方案，**只输出设计文档，不编写代码**

### 🎭 设计原则
- **思路先行**: 先阐明设计思路和决策逻辑
- **详设完整**: 输出完整的详细设计方案
- **系统一致**: 确保与现有系统架构保持一致性
- **通用适配**: 支持前端、后端、API、数据库等各类组件设计

---

## 🚀 6步简化交互式设计流程

### ⚠️ 执行控制要求
1. **步骤控制**：只能执行当前步骤，每完成一步必须等待用户回复 `yes` 才继续
2. **禁止跳步**：不得预判后续步骤或提前执行未来任务
3. **用户交互**：`yes` 继续下一步，`no` 重新处理当前步骤
4. **文档约定**：所有设计文档输出至 `docs/` 目录下

---

### Step 1: 需求分析与架构调研 🔍
**🎯 目标**: 理解需求，调研现有架构，确定设计策略

**📋 执行任务**:
- 自动读取 `docs/` 目录下的现有架构文档
- 解读业务需求和功能要点（支持单功能点或多功能点）
- 识别设计模式（增量设计 vs 全新设计）
- 分析技术约束和兼容性要求

**📤 输出格式**:
```markdown
## 需求分析与架构调研

### 需求理解
- **功能范围**: [具体功能点描述]
- **业务价值**: [预期目标和用户场景]
- **技术约束**: [性能、兼容性、安全要求]

### 架构调研
**参考文档**: docs/design/[现有架构文档]
- **设计模式**: [增量/全新设计]
- **现有架构**: [架构模式和技术栈]
- **兼容性约束**: [必须遵循的约束]

### 设计策略
- **设计范围**: [本次设计范围]
- **技术选型**: [核心技术决策]
- **实施方向**: [设计实施路径]
```

**⏸️ 等待用户确认**: 请回复 `yes` 继续下一步，或 `no` 重新分析

---

### Step 2: 实现思路分析 💭
**🎯 目标**: 分析实现思路，确定解决方案和技术路径

**📋 执行任务**:
- 分析功能实现的核心思路和方法
- 识别关键技术难点和解决思路
- 确定主要技术方案和实现路径
- 评估实现复杂度和技术风险

**📤 输出格式**:
```markdown
## 实现思路分析

### 核心思路
- **解决方案**: [主要解决思路和方法]
- **技术路径**: [实现的技术路径]
- **关键决策**: [重要的技术决策点]

### 技术难点
- **难点识别**: [主要技术难点]
- **解决思路**: [难点解决方案]
- **风险评估**: [技术风险和应对]

### 实现策略
- **实现顺序**: [功能实现的优先级]
- **技术选择**: [具体技术栈选择]
- **集成方案**: [与现有系统的集成思路]
```

**⏸️ 等待用户确认**: 请回复 `yes` 继续下一步，或 `no` 重新分析

---

### Step 3: 系统设计 🏗️
**🎯 目标**: 设计完整的系统架构、数据模型和API接口

**📋 执行任务**:
- 设计系统架构和模块划分
- 设计数据模型和存储结构
- 设计API接口和交互规范
- 确定技术栈和集成方案

**📤 输出格式**:
```markdown
## 系统设计方案

### 架构设计
- **整体架构**: [架构图和核心组件]
- **技术栈**: [具体技术选择和版本]
- **模块划分**: [功能模块和职责分工]

### 数据设计
- **数据模型**: [核心实体和关系]
- **存储方案**: [数据库设计和表结构]
- **数据流**: [数据流转和处理]

### 接口设计
- **API规范**: [接口风格和统一规范]
- **核心接口**: [主要接口定义和参数]
- **安全设计**: [认证、权限、数据验证]
```

**⏸️ 等待用户确认**: 请回复 `yes` 继续下一步，或 `no` 重新设计

---

### Step 4: 实现方案设计 🎨
**🎯 目标**: 设计具体的实现方案和组件结构

**📋 执行任务**:
- 设计核心组件和模块结构
- 规划实现策略和编码方案
- 制定性能优化和错误处理策略
- 确定关键算法和数据结构

**📤 输出格式**:
```markdown
## 实现方案设计

### 组件设计
- **核心组件**: [组件架构和接口设计]
- **模块结构**: [代码模块组织和依赖关系]
- **关键算法**: [核心算法设计和数据结构]

### 实现策略
- **设计模式**: [采用的设计模式]
- **编码规范**: [代码风格和开发规范]
- **技术实现**: [具体实现技术和工具]

### 质量保证
- **性能优化**: [性能目标和优化策略]
- **错误处理**: [异常处理和容错机制]
- **测试策略**: [单元测试和集成测试]
```

**⏸️ 等待用户确认**: 请回复 `yes` 继续下一步，或 `no` 重新设计

---

### Step 5: 详设文档生成 📋
**🎯 目标**: 生成完整的详细设计文档

**📋 执行任务**:
- 整合前面所有设计成果
- 生成完整的详细设计文档到docs目录
- 确保文档结构完整和内容准确
- 添加必要的图表和示例

**📤 输出内容**:

#### 生成详细设计文档
**文档路径**: `docs/design/[功能名称]-详细设计文档-v1.0.md`

**文档结构**:
```markdown
# [功能名称] 详细设计文档 v1.0

## 1. 概述
- 功能概述和设计目标
- 需求范围和业务价值

## 2. 实现思路
- 核心解决方案和技术路径
- 关键技术难点和解决思路

## 3. 系统设计
- 架构设计和模块划分
- 数据模型和接口设计

## 4. 实现方案
- 组件设计和实现策略
- 性能优化和质量保证

## 5. 技术规格
- 详细技术参数和配置
- 开发环境和部署要求

## 6. 附录
- 设计决策记录
- 参考文档和相关资料
```

**📄 文档生成确认**:
```
==== 详细设计文档已生成 ====

📄 **文档信息**:
- 文档位置: docs/design/[功能名称]-详细设计文档-v1.0.md
- 文档大小: [文档行数] 行
- 生成时间: [时间戳]

✅ **内容检查**:
- 需求分析和架构调研
- 实现思路和技术方案
- 系统设计和数据模型
- 实现方案和组件设计
- 技术规格和部署要求

📋 **文档质量**:
- 结构完整性: ✅
- 内容准确性: ✅
- 格式规范性: ✅
```

**⏸️ 等待用户确认**: 请回复 `yes` 继续下一步，或 `no` 重新生成

---

### Step 6: 一致性维护 🔗
**🎯 目标**: 检查系统一致性，完成设计阶段移交

**📋 执行任务**:
- 与现有架构文档进行一致性检查，"必要时需要更新架构文档"(重点关注)
- 验证技术栈和接口规范的兼容性
- 确认设计方案的完整性和可行性
- 完成设计阶段的最终确认和移交

**📤 输出内容**:

#### 一致性检查报告
```markdown
## 系统一致性检查报告

### 架构兼容性验证
- ✅ 架构模式一致性: [与现有架构的兼容性]
- ✅ 技术栈兼容性: [技术选择的兼容性]
- ✅ 接口规范统一性: [API设计规范一致性]
- ✅ 数据模型兼容性: [数据设计兼容性]

### 设计完整性验证
- ✅ 需求覆盖完整性: [需求实现覆盖情况]
- ✅ 技术方案可行性: [技术方案的可实施性]
- ✅ 系统集成兼容性: [与现有系统的集成]

### 检查结论
- **总体评估**: ✅ 通过一致性检查
- **风险等级**: [低/中/高]
- **移交状态**: 设计完成，可进入开发阶段
```

#### 设计阶段完成确认
```markdown
### 🎯 设计阶段完成

#### 交付成果
- ✅ 详细设计文档: docs/design/[功能名称]-详细设计文档-v1.0.md
- ✅ 一致性检查: 已通过系统兼容性验证
- ✅ 技术规格: 实施要求和技术标准已明确

#### 移交开发阶段
**✅ 设计阶段正式完成**
**🚀 可以启动develop阶段**

移交状态: 设计完成，已通过一致性检查，可进入开发阶段
```

**⏸️ 最终确认**: 请回复 `yes` 完成设计阶段，进入开发阶段

---

## 🚨 强制交互控制要求

### ⚠️ 绝对禁止行为
- **禁止跳步执行**: 未经用户确认不得进入下一步
- **禁止假设同意**: 必须等待用户明确回复
- **禁止批量输出**: 一次只能输出当前步骤内容
- **禁止代码实现**: 设计阶段不编写任何代码

### ✅ 必须执行行为
- **逐步等待确认**: 每步完成后等待用户 `yes`
- **自动读取docs**: 自动参考docs目录下的现有文档
- **输出详设文档**: 必须生成完整的md格式详设文档
- **一致性检查**: 强制执行与总体架构的一致性验证

### 📁 文档输出规范
- **文档位置**: docs/design/ 目录
- **命名规范**: [功能名称]-详细设计文档-v1.0.md
- **参考文档**: 自动读取docs/目录下的总体架构文档
- **一致性检查**: 强制对比总体架构设计文档

---

## 🎯 设计质量保证

### 📊 质量指标要求
- **设计思路清晰度**: ≥ 95%
- **技术方案完整性**: ≥ 95%
- **系统一致性**: 100%
- **文档规范合规性**: 100%

### 🔍 每步质量检查
每个步骤都必须通过以下检查：
- [ ] 输出内容完整准确
- [ ] 技术方案可行合理
- [ ] 文档格式规范统一
- [ ] 用户确认获得通过

---

## 总结

设计阶段采用**6步简化交互式设计流程**：

1. **Step 1**: 需求分析与架构调研 → 等待确认
2. **Step 2**: 实现思路分析 → 等待确认
3. **Step 3**: 系统设计 → 等待确认  
4. **Step 4**: 实现方案设计 → 等待确认
5. **Step 5**: 详设文档生成 → 等待确认
6. **Step 6**: 一致性维护(和) → 等待确认，yes 即完成

**核心价值**: 
- 通用适配各类系统组件设计
- 支持单功能点或多功能点设计
- 自动生成标准化详设文档
- 强制一致性检查保证系统兼容性
- 简化流程提高执行效率