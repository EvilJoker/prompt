# 📐 产品设计流程规则

## 🏷️ 规则元数据
- **类型**: 业务分析与技术设计
- **编号**: 02
- **版本**: v2.6
- **描述**: 6步质量增强设计流程，嵌入自动化质量检查
- **触发条件**: 前缀 `design` 或包含关键词 ["设计", "分析", "架构", "方案"]
- **执行模式**: 6步交互式设计 → 嵌入质量门禁 → 自动化检查 → 文档生成
- **依赖规则**: `02-common-standards.md`, `quality-templates.md`, `10-architecture-sync.md`

---

## 🎯 设计目标

**核心理念**: 基于业务需求，运用架构思维，采用质量增强设计模式，产出**高质量**、**可实现**、**标准化**的技术设计方案

### 🎭 设计原则
- **需求驱动**: 深度理解业务需求，设计紧贴实际场景
- **架构一致**: 严格遵循现有架构规范和技术栈
- **质量内嵌**: 关键步骤自动进行质量检查
- **标准输出**: 生成符合团队规范的设计文档

---

## 🚀 6步质量增强设计流程

### ⚠️ 执行控制要求
1. **步骤控制**：只能执行当前步骤，每完成一步必须等待用户回复 `yes` 才继续
2. **质量门禁**：Step1、Step3、Step5后自动进行质量检查
3. **用户交互**：`yes` 继续下一步，`no` 重新处理当前步骤
4. **文档约定**：所有设计文档输出至 `docs/feature/` 目录

---

### Step 1: 需求分析与架构调研 🔍
**🎯 目标**: 深度理解业务需求，完成技术可行性调研

**📋 执行任务**:
- 分析业务需求，明确功能边界和约束条件
- 调研现有架构和技术栈的支持能力
- 识别技术风险和实现难点
- 评估开发工作量和时间周期

**📤 输出格式**:
```markdown
## Step 1: 需求分析与架构调研结果

### 需求理解
- **核心功能**: [主要功能描述]
- **业务价值**: [解决什么问题，带来什么价值]
- **功能范围**: [功能边界和约束条件]
- **非功能需求**: [性能、安全、可用性要求]

### 技术约束
- **现有架构**: [当前技术栈和架构模式]
- **兼容性要求**: [与现有系统的集成要求]
- **技术限制**: [技术选型约束和限制]

### 架构调研
- **技术栈评估**: [Vue.js、Node.js等技术支持度]
- **组件复用性**: [可复用的现有组件和模块]
- **扩展性分析**: [未来扩展可能性评估]

### 风险评估
- **技术风险**: [主要技术实现风险]
- **时间风险**: [开发周期和里程碑风险]
- **资源风险**: [人力和技术资源风险]
```

**🔍 自动质量检查**: 应用 `design_requirements_quality_gate`
- ✅ 需求完整性: 功能需求、非功能需求、约束条件全覆盖
- ✅ 业务价值清晰: 明确解决什么问题，带来什么价值
- ✅ 可行性评估: 技术可行性、时间可行性、资源可行性
- ✅ 风险识别: 主要技术风险、业务风险、时间风险

**⏸️ 等待用户确认**: 请回复 `yes` 继续下一步，或 `no` 重新分析

---

### Step 2: 功能模块设计 📋
**🎯 目标**: 将需求分解为具体的功能模块和业务流程

**📋 执行任务**:
- 功能模块划分和职责定义
- 核心业务流程设计
- 用户交互流程设计
- 数据流向和状态管理设计

**📤 输出格式**:
```markdown
## Step 2: 功能模块设计

### 模块划分
- **核心模块**: [主要业务模块]
- **支撑模块**: [工具和公共模块]
- **集成模块**: [与现有系统集成模块]

### 业务流程
- **主要流程**: [核心业务处理流程]
- **异常流程**: [错误处理和异常场景]
- **边界条件**: [边界情况处理方案]

### 用户交互
- **交互流程**: [用户操作步骤和反馈]
- **界面设计**: [主要界面和交互元素]
- **用户体验**: [操作便利性和友好性]
```

**⏸️ 等待用户确认**: 请回复 `yes` 继续下一步，或 `no` 重新设计模块

---

### Step 3: 系统架构与接口设计 🏗️
**🎯 目标**: 设计系统架构、组件关系和接口规范

**📋 执行任务**:
- 系统架构设计和组件关系定义
- API接口设计和数据模型定义
- 数据库设计和数据关系定义
- 安全设计和权限控制方案

**📤 输出格式**:
```markdown
## Step 3: 系统架构与接口设计

### 系统架构
- **整体架构**: [系统架构图和说明]
- **组件关系**: [组件依赖和交互关系]
- **技术选型**: [框架和技术栈选择]

### 接口设计
- **API规范**: [RESTful接口设计]
- **数据模型**: [请求/响应数据结构]
- **错误处理**: [错误码和异常处理机制]

### 数据设计
- **数据模型**: [核心数据实体和属性]
- **数据关系**: [实体间关系和约束]
- **存储方案**: [数据存储和持久化方案]

### 安全设计
- **认证授权**: [用户认证和权限控制]
- **数据安全**: [数据加密和传输安全]
- **系统安全**: [安全防护和漏洞防范]
```

**🔍 自动质量检查**: 应用 `design_system_quality_gate`
- ✅ 架构一致性: 与技术栈和架构原则保持一致
- ✅ 接口设计规范: RESTful风格、参数合理、返回值完整
- ✅ 数据模型合理: 字段设计、关系设计、约束设计
- ✅ 可扩展性: 支持未来功能扩展和性能扩展

**⏸️ 等待用户确认**: 请回复 `yes` 继续下一步，或 `no` 重新设计架构

---

### Step 4: 技术实现方案 💡
**🎯 目标**: 制定具体的技术实现策略和开发指导

**📋 执行任务**:
- 技术实现策略和开发模式选择
- 关键算法和核心逻辑设计
- 性能优化和资源管理方案
- 测试策略和质量保证方案

**📤 输出格式**:
```markdown
## Step 4: 技术实现方案

### 实现策略
- **开发模式**: [开发方法和实现策略]
- **技术路线**: [技术实现路径和步骤]
- **关键技术**: [核心技术和关键算法]

### 性能方案
- **性能目标**: [响应时间、并发量等指标]
- **优化策略**: [缓存、异步、压缩等优化]
- **资源管理**: [内存、网络、存储资源管理]

### 质量方案
- **测试策略**: [单元测试、集成测试计划]
- **质量标准**: [代码质量和性能标准]
- **监控方案**: [系统监控和异常告警]
```

**⏸️ 等待用户确认**: 请回复 `yes` 继续下一步，或 `no` 重新制定方案

---

### Step 5: 详细设计文档生成 📋
**🎯 目标**: 整合前4步输出，生成完整的详细设计文档

**📋 执行任务**:
- 整合所有设计内容到标准化文档
- 补充实现细节和技术规格
- 生成开发指导和验收标准
- 创建部署和运维指导

**📤 输出内容**:
生成完整的详细设计文档到 `docs/feature/` 目录，包含：

```markdown
# [功能名称]-详细设计文档-v1.0

## 1. 概述
[Step1的需求分析结果]

## 2. 功能设计
[Step2的功能模块设计结果]

## 3. 系统设计
[Step3的系统架构与接口设计结果]

## 4. 实现方案
[Step4的技术实现方案结果]

## 5. 数据设计
[数据模型和接口定义详细说明]

## 6. 技术规格
[开发环境、配置参数、部署要求]

## 7. 质量标准
[测试用例、验收标准、性能指标]

## 8. 部署指南
[环境配置、部署步骤、运维要求]
```

**🔍 自动质量检查**: 应用 `design_complete_quality_gate`
- ✅ 文档完整性: 所有设计章节完整，无缺失内容
- ✅ 设计一致性: 各部分设计互相匹配，无冲突
- ✅ 可实现性: 设计方案技术上可以实现
- ✅ 可测试性: 设计具备可测试的接口和验证点

**⏸️ 等待用户确认**: 请回复 `yes` 继续下一步，或 `no` 重新生成文档

---

### Step 6: 设计质量检查与交付 ✅
**🎯 目标**: 对设计方案进行全面质量检查并准备交付

**📋 执行任务**:
- 进行设计方案的全面质量检查
- 执行设计阶段一致性检查
- 生成设计完成报告
- 准备开发移交材料

#### 🔍 设计阶段一致性检查
**📋 使用统一一致性检查模板**
参考: `10-architecture-sync.md` → 设计阶段一致性检查

**执行方式**: 使用 `10-architecture-sync.md` 通用一致性检查模板，重点关注：
- **需求-设计一致性**: 确保设计完全覆盖需求
- **架构-设计一致性**: 设计符合总体架构

**快速检查清单**:
- [ ] 功能需求100%覆盖
- [ ] 非功能需求明确设计方案
- [ ] 接口设计符合架构规范
- [ ] 数据模型与架构数据设计一致
- [ ] 技术选型符合架构约束

**📤 输出格式**:
```markdown
## 设计完成报告

### 🎯 设计摘要
- **设计版本**: v1.0
- **涉及模块**: [核心模块清单]
- **技术栈**: [确定的技术选择]
- **预估工作量**: [开发时间评估]

### 📋 设计交付物
- ✅ 详细设计文档 (docs/feature/xxx-详细设计文档-v1.0.md)
- ✅ 系统架构图
- ✅ 数据模型图  
- ✅ API接口文档
- ✅ 实现方案说明

### 🔍 一致性检查结果
**参考**: `10-architecture-sync.md` 通用一致性检查模板

#### 📊 总体得分: [XX]/100

| 检查维度 | 权重 | 得分 | 状态 | 问题数 | 说明 |
|----------|------|------|------|--------|------|
| 需求覆盖 | 30% | XX/30 | ✅/⚠️/❌ | X | [具体说明] |
| 架构遵循 | 25% | XX/25 | ✅/⚠️/❌ | X | [具体说明] |
| 接口规范 | 20% | XX/20 | ✅/⚠️/❌ | X | [具体说明] |
| 数据模型 | 15% | XX/15 | ✅/⚠️/❌ | X | [具体说明] |
| 技术选型 | 10% | XX/10 | ✅/⚠️/❌ | X | [具体说明] |

### 🎯 下一阶段准备
- **开发环境**: [环境准备要求]
- **技术依赖**: [需要安装的依赖]
- **关键风险**: [开发阶段注意事项]
```

**🔍 自动质量检查**: 应用 `design_completion_quality_gate`
- ✅ 交付物完整性: 所有设计文档100%生成
- ✅ 一致性得分: 总体得分≥85分
- ✅ 开发就绪度: 开发材料准备完整
- ✅ 风险控制: 主要风险识别并有应对方案

**🔄 下一阶段引导**: 
设计完成后，建议进入 **03-develop.md** 开发流程，进行代码实现。

**⏸️ 等待用户确认**: 请回复 `yes` 完成设计流程，或 `no` 继续调整

---

## 🚨 强制交互控制要求

### ⚠️ 绝对禁止行为
- **禁止跳步执行**: 未经用户确认不得进入下一步
- **禁止假设同意**: 必须等待用户明确回复
- **禁止跳过质量检查**: Step1、Step3、Step5必须执行质量门禁
- **禁止文档缺失**: 必须生成完整的详细设计文档

### ✅ 必须执行行为
- **逐步等待确认**: 每步完成后等待用户 `yes`
- **自动质量检查**: 关键步骤自动进行质量门禁检查
- **标准文档输出**: 严格按照文档模板生成设计文档
- **架构一致性检查**: 确保与现有架构和技术栈兼容

---

## 🎯 设计质量保证

### 📊 嵌入式质量指标
- **需求理解准确性**: ≥ 95% (自动检查)
- **系统设计合理性**: ≥ 90% (自动检查)  
- **文档完整性**: ≥ 95% (自动检查)
- **架构一致性**: 100% (强制检查)

### 🔍 自动化质量保证
- Step1后: 自动检查需求完整性、业务价值清晰、可行性评估、风险识别
- Step3后: 自动检查架构一致性、接口设计规范、数据模型合理、可扩展性
- Step5后: 自动检查文档完整性、设计一致性、可实现性、可测试性

---

## 总结

设计阶段采用**6步质量增强设计流程**：

1. **Step 1**: 需求分析与架构调研 → **质量门禁** → 等待确认
2. **Step 2**: 功能模块设计 → 等待确认
3. **Step 3**: 系统架构与接口设计 → **质量门禁** → 等待确认
4. **Step 4**: 技术实现方案 → 等待确认
5. **Step 5**: 详细设计文档生成 → **质量门禁** → 等待确认
6. **Step 6**: 设计质量检查与交付 → 完成设计

**核心价值**:
- 质量内嵌保证设计标准，减少返工
- 自动化检查减少手动评审工作
- 嵌入式质量门禁确保每步质量达标
- 标准化文档输出便于开发实施